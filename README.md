# Claude Ultra

> **Opinionated** autonomous CI/CD pipeline powered by Claude AI for software development.

An opinionated approach to AI-assisted development: strict TDD, Clean Architecture, conventional commits, and expert personas that act autonomously without asking questions.

## Features

- **8 Expert Personas**: Product Owner, Architect, Implementer, Refactorer, QA Engineer, Security Auditor, Documenter, Committer
- **Sequential Mode**: Complete pipeline with a single agent
- **Parallel Mode**: Swarm of N agents on N tasks via Git Worktrees + tmux
- **Merger Agent**: Intelligent Git conflict resolution using AI
- **Monitoring**: API quota tracking (5h session, 7-day weekly)
- **Rate Limiting**: Protection against quota overruns
- **Smart Detection**: Auto-stop when no more progress is made

## Prerequisites

- [Claude CLI](https://claude.ai/code) installed and configured
- Git
- tmux (for parallel mode)
- jq (for JSON parsing)

## Installation

```bash
git clone <repo-url>
cd claude-ultra
chmod +x claude-ultra.sh
```

## Usage

### Sequential Mode (default)

```bash
./claude-ultra.sh
```

Runs the complete pipeline on one task at a time from `TODO.md`.

### Parallel Mode

```bash
./claude-ultra.sh --parallel           # 3 agents by default
./claude-ultra.sh -p -a 5              # 5 parallel agents
./claude-ultra.sh -p --token-efficient # Token-saving mode
```

### Options

| Option | Description |
|--------|-------------|
| `--parallel`, `-p` | Enable parallel mode (swarm) |
| `--agents N`, `-a N` | Number of parallel agents (default: 3) |
| `--token-efficient` | Short responses to save tokens |
| `--max-calls N` | API calls limit per hour (default: 50) |
| `--help`, `-h` | Show help |

## Control Files

| File | Description |
|------|-------------|
| `TODO.md` | Task list (`- [ ] My task`) |
| `@fix_plan.md` | Priority fix plan (optional) |
| `@AGENT.md` | Custom agent configuration (optional) |
| `ARCHITECTURE.md` | Architecture documentation (auto-generated) |
| `@current_task.md` | Current task (generated by PO) |

## Pipeline (Sequential Mode)

```
1. Product Owner    → Selects ONE priority task
2. Architect        → Validates/enriches architecture
3. Implementer      → Codes with TDD (Red-Green-Refactor)
4. Refactorer       → Eliminates code smells
5. QA Engineer      → Tests edge cases
6. Security Auditor → OWASP Top 10 audit
7. Documenter       → Updates TODO.md and docs
8. Committer        → Automatic conventional commit
```

## Parallel Mode (Swarm)

Parallel mode uses Git Worktrees to run multiple agents simultaneously:

1. Extracts N tasks from `TODO.md`
2. Creates N worktrees with isolated branches
3. Launches N agents in parallel via tmux
4. Merges completed branches
5. Resolves conflicts with the Merger Agent (AI)

### tmux Navigation

- `Ctrl+B` then `0/1/2...`: Go to a window
- `Ctrl+B` then `n/p`: Next/previous window
- `Ctrl+B` then `d`: Detach (agents keep running)

## Environment Variables

```bash
PARALLEL_MODE=true           # Enable parallel mode
PARALLEL_AGENTS=3            # Number of agents
TOKEN_EFFICIENT_MODE=true    # Token-saving mode
MAX_CALLS_PER_HOUR=50        # Rate limiting cap
QUOTA_WARN_SESSION=70        # Session quota warning (%)
QUOTA_STOP_SESSION=90        # Session quota stop (%)
QUOTA_WARN_WEEKLY=80         # Weekly quota warning (%)
QUOTA_STOP_WEEKLY=95         # Weekly quota stop (%)
```

## MCP Integration

Personas automatically use available MCP tools:

- **Context7**: Official framework documentation
- **Sequential-thinking**: Step-by-step complex reasoning
- **Playwright**: Cross-browser E2E testing
- **Chrome DevTools**: Performance debugging, DOM, Network

## Documentation

Detailed documentation is available in the `docs/` folder:

| Document | Language | Description |
|----------|----------|-------------|
| [Architecture](docs/architecture.md) | EN/FR | System design and flow diagrams |
| [Personas](docs/personas.md) | EN/FR | Detailed persona specifications |
| [Parallel Mode](docs/parallel-mode.md) | EN/FR | Swarm mode deep dive |
| [Troubleshooting](docs/troubleshooting.md) | EN/FR | Common issues and solutions |

---

## Credits

This project draws inspiration from several excellent approaches:

- **[SuperClaude](https://github.com/NomenAK/SuperClaude)** - Expert personas, token-efficient mode, evidence-based approach
- **[Ralph](https://github.com/rvanmarkus/ralph)** - Smart task completion detection, rate limiting, `@` control files

Thanks to these projects for their ideas and patterns!

## License

MIT
